---
title: "Day6: Kubernetes Cluster Maintenance"
seoTitle: "Kubernetes cluster setup, OS upgrades, Backup and restore"
datePublished: Sat Nov 22 2025 08:00:10 GMT+0000 (Coordinated Universal Time)
cuid: cmia017kw000402jw8473hso4
slug: day6-kubernetes-cluster-maintenance
cover: https://cdn.hashnode.com/res/hashnode/image/upload/v1763704099930/b5746782-836d-4b4c-aea3-14ed397abec2.png
ogImage: https://cdn.hashnode.com/res/hashnode/image/upload/v1763798346881/433ec842-409e-4d20-81ce-528d70655b15.png
tags: k8s-series

---

## OS Upgrades

While doing OS upgrades and Security patches, follow the steps below:

1. Drain the node, pods that exist in the node gracefully terminated and recreated on other nodes, node marked as unscheduled/cordon, so no pods are allowed to create on it.
    
    ```bash
    kubectl drain node01 --ignore-daemonsets
    ```
    
2. Once the node comes online, un-cordon it to schedule pods. Pods were moved to another node that won’t fall back. If we create new pods on the cluster get assigned to this node.
    
    ```bash
    kubectl uncordon node-1
    ```
    
3. cordon: marks node as unscheduled, unlike drain, it won’t move/terminate existing pods, it makes sure new pods are not scheduled on that node.
    
    ```bash
    kubectl cordon node-1
    ```
    

## Kubernetes Releases

Kubernetes releases new versions every few months. its consists of 3 parts; all components will have the same version except etcd cluster and core DNS, which are part of different projects.

```bash
NAME       STATUS   ROLES           AGE   VERSION
node01     Ready    control-plane   25d   v1.34.2

v1 = Major release
34 = minor: features and functionalities 
2 =  Patch: bug fixes are released more often, with critical bug fixes
```

## Cluster Upgrade

### Introduction

* As part of the release process, k8s only supports up to the recent 3 minor versions.
    
* we can upgrade one minor version at a time Ex: v1.32 → v1.33 → v1.34.
    
* Upgrade the master node first, then the worker node.
    

### Strategies to Upgrade Worker node

1. Upgrade all worker nodes at a time - required downtime
    
2. Upgrade one node at a time
    
3. Introduce new nodes with a newer software version, move workloads to new node, and delete old one.
    

### Kubeadm Upgrade

* **Master Node:** Kubeadm and Kubernetes versions are always the same, run the commands below
    
* ```bash
                kubeadm upgrade plan
                apt-get upgrade -y kubeadm=1.31.0-00
                kubeadm upgrade 1.31.0
                apt-get upgrade -y kubelet=1.31.0    #if kubelts on master node
                systemctl restart kubelet
    ```
    
* **Work node:** upgrade node by node
    
* ```bash
                kubectl drain node-1
                apt-get upgrade -y kubeadm=1.31.0-00
                apt-get upgrade -y kubelet=1.31.0-00
                kubeadm upgrade node config --kubelt-version v1.31.0
                systemctl restart kubelet
                kubectl uncordon node-1
    ```
    

## Upgrading Production Cluster:

1. check version
    
2. ```bash
       $ kubectl get nodes
        NAME           STATUS   ROLES           AGE   VERSION
        controlplane   Ready    control-plane   12m   v1.33.0
        node01         Ready    <none>          12m   v1.33.0
    ```
    
3. Check how many nodes can host workloads in this cluster
    
    ```bash
    $ controlplane ~ ➜  kubectl describe node controlplane | grep taints
    
    $ controlplane ~ ✖ kubectl describe nodes controlplane | grep  -i taints
    Taints:             <none>
    
    $ controlplane ~ ➜  kubectl describe nodes node01 | grep  -i taints
    Taints:             <none>
    ```
    
4. How many applications are hosted on the cluster? Check the number of deployments.
    

```bash
controlplane ~ ➜  kubectl get deployments
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
finance  5/5     5            5           9m15s
```

4. What nodes are the pods hosted on
    
    ```bash
    controlplane ~ ➜  kubectl get pods -o wide
    NAME                    READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES
    finance-69968556cc-8wmrs   1/1     Running   0          11m   172.17.1.4   node01         <none>           <none>
    finance-69968556cc-dvm5c   1/1     Running   0          11m   172.17.0.4   controlplane   <none>           <none>
    finance-69968556cc-kwrf4   1/1     Running   0          11m   172.17.1.2   node01         <none>           <none>
    finance-69968556cc-scf7t   1/1     Running   0          11m   172.17.0.5   controlplane   <none>           <none>
    finance-69968556cc-v2gjg   1/1     Running   0          11m   172.17.1.3   node01         <none>           <none>
    ```
    
5. Users accessing the applications must not be impacted, and you cannot provision new VMs. In this case will upgrade node at a time while moving workloads to other nodes.
    
6. Check the latest version available for an upgrade with the current version of the kubeadm tool installed.
    
    ```bash
    $ kubeadm upgrade plan
    
    Upgrade to the latest version in the v1.33 series:
    
    COMPONENT                 NODE           CURRENT    TARGET
    kube-apiserver            controlplane   v1.33.0    v1.33.6
    kube-controller-manager   controlplane   v1.33.0    v1.33.6
    kube-scheduler            controlplane   v1.33.0    v1.33.6
    kube-proxy                               1.33.0     v1.33.6
    CoreDNS                                  v1.10.1    v1.12.0
    etcd                      controlplane   3.5.21-0   3.5.21-0
    ```
    

### Upgrade the control plane node first.

7. ```bash
       $ kubectl drain controlplane --ignore-daemonsets
    ```
    
8. Check out the file for the Kubernetes apt repository to see the version and update it to the desired version, which version need to use v1.34. Make changes in the file, then save.
    
    ```bash
    $ vim /etc/apt/sources.list.d/kubernetes.list
    
    deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.33/deb/ /
    ```
    
9. Find the latest patch release for Kubernetes 1.34 using the OS package manager
    
    ```bash
    sudo apt update
    sudo apt-cache madison kubeadm
     kubeadm | 1.34.2-1.1 | https://pkgs.k8s.io/core:/stable:/v1.34/deb  Packages
     kubeadm | 1.34.1-1.1 | https://pkgs.k8s.io/core:/stable:/v1.34/deb  Packages
     kubeadm | 1.34.0-1.1 | https://pkgs.k8s.io/core:/stable:/v1.34/deb  Packages
    ```
    
10. it indicates that for Kubernetes version `1.34.0`, the available package version is `1.34.0-1.1`. Therefore, to install kubeadm for Kubernetes `v1.34.0`
    

10\. upgrade kubeadm.

```bash
apt-get install kubeadm=1.34.0-1.1
```

11\. upgrade Kubernets cluster.

```bash
kubeadm upgrade plan v1.34.0
kubeadm upgrade apply v1.34.0
```

12. upgrade kubelet version.
    

```bash
apt-get install kubelet=1.34.0-1.1
```

13. Restart the systemd configuration.
    

```bash
systemctl daemon-reload
systemctl restart kubelet
```

14. make kubernets control plane schedulable.
    
    ```bash
    kubectl uncordon controlplane
    ```
    

### Upgrade worker node

do it node by node to avoid application down time.

1. ssh into worker node
    
    ```bash
    $ ssh node01
    ```
    
2. drain node to not to allocate any pods
    
    ```bash
    $ kubectl drain node01
    ```
    
3. update kubernetes list file to latest version.
    
    ```bash
    $ vim /etc/apt/sources.list.d/kubernetes.list
    deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.34/deb/ /
    ```
    
4. check compatible patch version.
    

```bash
apt update
apt-cache madison kubeadm
```

5. update kubeadm version.
    
    ```bash
    apt-get install kubeadm=1.34.0-1.1
    kubeadm upgrade node
    ```
    
6. kubelet version upgrade.
    
    ```bash
    apt-get install kubelet=1.34.0-1.1
    ```
    
7. restart kubelet.
    
8. ```bash
        systemctl daemon-reload
        systemctl restart kubelet
    ```
    
9. uncordon worker node.
    
    ```bash
    kubectl uncordon node01
    ```
    
10. Repeat same steps for the other nodes.